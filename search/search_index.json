{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Culvert Analysis Toolkit This documentation is a work-in-progress The Culvert Analysis Toolkit is an Inlet + Culvert Peak-Flow and Capacity Calculator that uses a TR-55 Model and parameters derived from geospatial data. See Installation to get the Culvert Analysis Toolkit running in ArcGIS Pro The toolbox page provides an overview of the toolbox. See the Data Guides overview to understand the types inputs the tool requires The Analysis Guide overview describes the ways the tool can be run. Credits/Contributors This software encompasses work originally developed by the Cornell Soil & Water Lab (on GitHub @ github.com/SoilWaterLab ) This repository represents an evolution of a previous effort, the Peak-Flow Calculator , which was a hard fork of the Water Lab's CulvertEvalution repository. Made in collaboration with the Cornell S&W lab, this repository includes additional updates to the science of the from CulvertModel_2.1 . Original peak flow analytics are based on the culvert evaluation model developed by Rebecca Marjerison at the Cornell Soil and Water Lab in 2013, as CulvertEvalution David Gold, python script development, August 4, 2015 Object-oriented structure and resiliency updates built by Noah Warnke, August 31 2016 (no formulas changed). Updated by Zoya Kaufmann June 2016 - August 2017 Merged with older versions by Tanvi Naidu June 19 2017 Fork, refactor, and creation of CLI and ArcMap interfaces by Christian Gass @ CivicMapper, Fall 2017, as peak-flow-calculator Updates for use within ArcGIS Pro by Christian Gass @ CivicMapper, Spring/Summer 2019, in peak-flow-calculator CulvertModel_2.1 by Jo Archibald in 2019 Drain-It repository by CivicMapper, 2021-2022","title":"Culvert Analysis Toolkit"},{"location":"#culvert-analysis-toolkit","text":"This documentation is a work-in-progress The Culvert Analysis Toolkit is an Inlet + Culvert Peak-Flow and Capacity Calculator that uses a TR-55 Model and parameters derived from geospatial data. See Installation to get the Culvert Analysis Toolkit running in ArcGIS Pro The toolbox page provides an overview of the toolbox. See the Data Guides overview to understand the types inputs the tool requires The Analysis Guide overview describes the ways the tool can be run.","title":"Culvert Analysis Toolkit"},{"location":"#creditscontributors","text":"This software encompasses work originally developed by the Cornell Soil & Water Lab (on GitHub @ github.com/SoilWaterLab ) This repository represents an evolution of a previous effort, the Peak-Flow Calculator , which was a hard fork of the Water Lab's CulvertEvalution repository. Made in collaboration with the Cornell S&W lab, this repository includes additional updates to the science of the from CulvertModel_2.1 . Original peak flow analytics are based on the culvert evaluation model developed by Rebecca Marjerison at the Cornell Soil and Water Lab in 2013, as CulvertEvalution David Gold, python script development, August 4, 2015 Object-oriented structure and resiliency updates built by Noah Warnke, August 31 2016 (no formulas changed). Updated by Zoya Kaufmann June 2016 - August 2017 Merged with older versions by Tanvi Naidu June 19 2017 Fork, refactor, and creation of CLI and ArcMap interfaces by Christian Gass @ CivicMapper, Fall 2017, as peak-flow-calculator Updates for use within ArcGIS Pro by Christian Gass @ CivicMapper, Spring/Summer 2019, in peak-flow-calculator CulvertModel_2.1 by Jo Archibald in 2019 Drain-It repository by CivicMapper, 2021-2022","title":"Credits/Contributors"},{"location":"analysis-overview/","text":"Overview Using the tools; best practices for working with large datasets and basins Model Input Consideration Balancing DEM hydrologic and NAACC location-correctedness Full hydrologic correction of the DEM and re-locating of culverts with LIDAR and imagery snap culverts to available hydro steam lines, burn the lines into the DEMs Depends on the use case! NAACC culvert data accuracy (spatial and temporal) ... Hydrologically-corrected Digital Elevation Models (DEMs) ...","title":"Overview"},{"location":"analysis-overview/#overview","text":"Using the tools; best practices for working with large datasets and basins","title":"Overview"},{"location":"analysis-overview/#model-input-consideration","text":"Balancing DEM hydrologic and NAACC location-correctedness Full hydrologic correction of the DEM and re-locating of culverts with LIDAR and imagery snap culverts to available hydro steam lines, burn the lines into the DEMs Depends on the use case!","title":"Model Input Consideration"},{"location":"analysis-overview/#naacc-culvert-data-accuracy-spatial-and-temporal","text":"...","title":"NAACC culvert data accuracy (spatial and temporal)"},{"location":"analysis-overview/#hydrologically-corrected-digital-elevation-models-dems","text":"...","title":"Hydrologically-corrected Digital Elevation Models (DEMs)"},{"location":"culvert-capacity/","text":"Culvert Capacity Calculator","title":"Culvert Capacity Calculator"},{"location":"culvert-capacity/#culvert-capacity-calculator","text":"","title":"Culvert Capacity Calculator"},{"location":"curve-number-raster/","text":"Generating a Curve Number Raster","title":"Generating a Curve Number Raster"},{"location":"curve-number-raster/#generating-a-curve-number-raster","text":"","title":"Generating a Curve Number Raster"},{"location":"data-overview/","text":"Overview Preparing data for use in the tools","title":"Overview"},{"location":"data-overview/#overview","text":"Preparing data for use in the tools","title":"Overview"},{"location":"dem-rasters/","text":"Digital Elevation Model-derived Data","title":"Digital Elevation Model-derived Data"},{"location":"dem-rasters/#digital-elevation-model-derived-data","text":"","title":"Digital Elevation Model-derived Data"},{"location":"dev-project-structure/","text":"Project Structure The project is structure so there is a fairly clear separation of concerns between the code that handles the science behind the calculators the geoprocessing tools used to derive spatial statistics from the various map layers the specific i/o requirements and interfaces expected in end-user workflows src/ The folder contains external-facing interfaces that use the drainit package. It includes: CulvertToolbox.pyt and associated xml metadata. legacy drainit.tbx file (replaced by CulvertToolbox.pyt ) tbx_*.py scripts, which are workflow-specific and map 1:1 with tools in the ArcGIS Pro toolbox drainit.tbx . src/drainit/ This is the top-level package. It contains a few scripts: workflows.py Contains the code for executing analytical workflows at the highest level of abstraction. A single workflow is represented by a single python class. All workflow classes inherit from a base class that contains properties and methods for reading/writing workflow state to a JSON configuration file. cli.py Command line interface to the scripting tools (WIP). config.py and settings.py Constants used for script execution. models.py Internal data models used throughout the package. calculators/ Module containing the science and business logic of the various calculators available in the package: runoff/peak flow culvert capacity services/ Scripts for interacting with third-party domain-specific data sources (e.g., NOAA rainfall data, NAACC culvert data) and geoprocessing tools (e.g., Esri ArcPy, Whitebox tools). gp/ Geoprocessing services designed on specific provider tools (e.g., ESRI, Whitebox) and exposed through a generic class that is called by the workflow tools. This ensures workflow.py can run GP tools without needing to know exactly what underlying geoprocessing library is being used. esri/ This folder contains the built ArcGIS Pro Python toolbox, its metadata, and an arcpy interface script. These are automatically created during the build process and do not need to be manually edited under normal circumstances. Scripts: noaa and naaccc These are data provider-specific scripts that do that work tests/ Integration tests for workflows and tasks within workflows.","title":"Project Structure"},{"location":"dev-project-structure/#project-structure","text":"The project is structure so there is a fairly clear separation of concerns between the code that handles the science behind the calculators the geoprocessing tools used to derive spatial statistics from the various map layers the specific i/o requirements and interfaces expected in end-user workflows","title":"Project Structure"},{"location":"dev-project-structure/#src","text":"The folder contains external-facing interfaces that use the drainit package. It includes: CulvertToolbox.pyt and associated xml metadata. legacy drainit.tbx file (replaced by CulvertToolbox.pyt ) tbx_*.py scripts, which are workflow-specific and map 1:1 with tools in the ArcGIS Pro toolbox drainit.tbx .","title":"src/"},{"location":"dev-project-structure/#srcdrainit","text":"This is the top-level package. It contains a few scripts:","title":"src/drainit/"},{"location":"dev-project-structure/#workflowspy","text":"Contains the code for executing analytical workflows at the highest level of abstraction. A single workflow is represented by a single python class. All workflow classes inherit from a base class that contains properties and methods for reading/writing workflow state to a JSON configuration file.","title":"workflows.py"},{"location":"dev-project-structure/#clipy","text":"Command line interface to the scripting tools (WIP).","title":"cli.py"},{"location":"dev-project-structure/#configpy-and-settingspy","text":"Constants used for script execution.","title":"config.py and settings.py"},{"location":"dev-project-structure/#modelspy","text":"Internal data models used throughout the package.","title":"models.py"},{"location":"dev-project-structure/#calculators","text":"Module containing the science and business logic of the various calculators available in the package: runoff/peak flow culvert capacity","title":"calculators/"},{"location":"dev-project-structure/#services","text":"Scripts for interacting with third-party domain-specific data sources (e.g., NOAA rainfall data, NAACC culvert data) and geoprocessing tools (e.g., Esri ArcPy, Whitebox tools).","title":"services/"},{"location":"dev-project-structure/#gp","text":"Geoprocessing services designed on specific provider tools (e.g., ESRI, Whitebox) and exposed through a generic class that is called by the workflow tools. This ensures workflow.py can run GP tools without needing to know exactly what underlying geoprocessing library is being used.","title":"gp/"},{"location":"dev-project-structure/#esri","text":"This folder contains the built ArcGIS Pro Python toolbox, its metadata, and an arcpy interface script. These are automatically created during the build process and do not need to be manually edited under normal circumstances.","title":"esri/"},{"location":"dev-project-structure/#scripts-noaa-and-naaccc","text":"These are data provider-specific scripts that do that work","title":"Scripts: noaa and naaccc"},{"location":"dev-project-structure/#tests","text":"Integration tests for workflows and tasks within workflows.","title":"tests/"},{"location":"dev-setup/","text":"Setup Anaconda Python and dependencies Development requires access to the arcpy library include with ArcGIS Pro, and a ArcGIS Pro-dervied Conda environment that includes the dependenices listed in setup\\requirements.txt","title":"Setup Anaconda Python and dependencies"},{"location":"dev-setup/#setup-anaconda-python-and-dependencies","text":"Development requires access to the arcpy library include with ArcGIS Pro, and a ArcGIS Pro-dervied Conda environment that includes the dependenices listed in setup\\requirements.txt","title":"Setup Anaconda Python and dependencies"},{"location":"installation/","text":"Installation 1. Download the Culvert Analysis Toolkit installation file Head to the Releases page (github.com/civicmapper/culvert-toolkit/releases) and download the .whl file from the latest version of the tool. 2. Create a dedicated Python environment in ArcGIS Pro To use this package, you'll need to install it a custom Python environment for ArcGIS Pro. Clone the default ArcGIS Pro conda environment . Switch the current ArcGIS Pro conda environment to the cloned environment using the Python Package Manager . For more information on working with Python environments in ArcGIS Pro, see Esri's documentation . Once you've done this, close ArcGIS Pro. 3. Install Now that you have the installation file and the custom Python environment, you can install the toolbox. ArcGIS Pro comes with a \"Python Command Prompt\" shortcut available, which runs a batch script that automatically starts a command prompt with ArcGIS Pro's active Conda environment available. Typically this gets added to your Windows Start Menu alongside the shortcut to ArcGIS Pro. Open the Python Command Prompt that came with your ArcGIS Pro installation. In the command prompt, run pip install <path-to-the-whl-file\\drainit.whl> . You'll replace <path-to-the-whl-file\\drainit.whl> with the full path to the wheel file you downloaded in the previous step. After that you should see a Culvert Analysis Toolkit toolbox listed alongside other toolboxes in the ArcToolbox pane of ArcGIS Pro. You may need to restart ArcGIS Pro before you see it.","title":"Installation"},{"location":"installation/#installation","text":"","title":"Installation"},{"location":"installation/#1-download-the-culvert-analysis-toolkit-installation-file","text":"Head to the Releases page (github.com/civicmapper/culvert-toolkit/releases) and download the .whl file from the latest version of the tool.","title":"1. Download the Culvert Analysis Toolkit installation file"},{"location":"installation/#2-create-a-dedicated-python-environment-in-arcgis-pro","text":"To use this package, you'll need to install it a custom Python environment for ArcGIS Pro. Clone the default ArcGIS Pro conda environment . Switch the current ArcGIS Pro conda environment to the cloned environment using the Python Package Manager . For more information on working with Python environments in ArcGIS Pro, see Esri's documentation . Once you've done this, close ArcGIS Pro.","title":"2. Create a dedicated Python environment in ArcGIS Pro"},{"location":"installation/#3-install","text":"Now that you have the installation file and the custom Python environment, you can install the toolbox. ArcGIS Pro comes with a \"Python Command Prompt\" shortcut available, which runs a batch script that automatically starts a command prompt with ArcGIS Pro's active Conda environment available. Typically this gets added to your Windows Start Menu alongside the shortcut to ArcGIS Pro. Open the Python Command Prompt that came with your ArcGIS Pro installation. In the command prompt, run pip install <path-to-the-whl-file\\drainit.whl> . You'll replace <path-to-the-whl-file\\drainit.whl> with the full path to the wheel file you downloaded in the previous step. After that you should see a Culvert Analysis Toolkit toolbox listed alongside other toolboxes in the ArcToolbox pane of ArcGIS Pro. You may need to restart ArcGIS Pro before you see it.","title":"3. Install"},{"location":"naacc-table/","text":"Working with NAACC Culvert Data Initial Download and Clean-Up Download the XLSX file from NAACC Delete headers (first eight rows) Save as CSV Optionally: While the NAACC Table Ingest will flag records that aren't valid for capacity calculations, you may want to pair back to download to records of interest. You may want to remove certain types of culvert, e.g., bridges, fords, or ones that don't have any capacity measurements. Or, you may need to import this table into GIS, and move features to streams or flow lines on a digital elevation model. Regardless, as long as the NAACC schema is preserved, subsequent tools will be able to use it. Run the NAACC Table Ingest tool The NAACC Table Ingest tool will read in, validate, and extend a NAACC-compliant source table, saving the output as geodata (e.g., a file geodatabase feature class. Use the prepared CSV above as an input. If you've imported that CSV to a file geodatabase feature class already, that feature class will also work. An optional input for this tool allows you to supply a table representing corrected locations for crossings. If provided, the tool will update the input NAACC-compliant source table with locations from this optional input.","title":"Working with NAACC Culvert Data"},{"location":"naacc-table/#working-with-naacc-culvert-data","text":"","title":"Working with NAACC Culvert Data"},{"location":"naacc-table/#initial-download-and-clean-up","text":"Download the XLSX file from NAACC Delete headers (first eight rows) Save as CSV","title":"Initial Download and Clean-Up"},{"location":"naacc-table/#optionally","text":"While the NAACC Table Ingest will flag records that aren't valid for capacity calculations, you may want to pair back to download to records of interest. You may want to remove certain types of culvert, e.g., bridges, fords, or ones that don't have any capacity measurements. Or, you may need to import this table into GIS, and move features to streams or flow lines on a digital elevation model. Regardless, as long as the NAACC schema is preserved, subsequent tools will be able to use it.","title":"Optionally:"},{"location":"naacc-table/#run-the-naacc-table-ingest-tool","text":"The NAACC Table Ingest tool will read in, validate, and extend a NAACC-compliant source table, saving the output as geodata (e.g., a file geodatabase feature class. Use the prepared CSV above as an input. If you've imported that CSV to a file geodatabase feature class already, that feature class will also work. An optional input for this tool allows you to supply a table representing corrected locations for crossings. If provided, the tool will update the input NAACC-compliant source table with locations from this optional input.","title":"Run the NAACC Table Ingest tool"},{"location":"noaa-rainfall/","text":"Getting NOAA Rainfall Data","title":"Getting NOAA Rainfall Data"},{"location":"noaa-rainfall/#getting-noaa-rainfall-data","text":"","title":"Getting NOAA Rainfall Data"},{"location":"peak-flow/","text":"Peak Flow Calculator Runoff peak discharge of given point's watershed is determined using the SCS graphical curve number method. For more information on this method, see Technical Release 55 .","title":"Peak Flow Calculator"},{"location":"peak-flow/#peak-flow-calculator","text":"Runoff peak discharge of given point's watershed is determined using the SCS graphical curve number method. For more information on this method, see Technical Release 55 .","title":"Peak Flow Calculator"},{"location":"run-batch/","text":"Batch Running the Capacity Calculator approaches for batching analysis for large areas","title":"Batch Running the Capacity Calculator"},{"location":"run-batch/#batch-running-the-capacity-calculator","text":"approaches for batching analysis for large areas","title":"Batch Running the Capacity Calculator"},{"location":"run-one/","text":"Running the Capacity Calculator","title":"Running the Capacity Calculator"},{"location":"run-one/#running-the-capacity-calculator","text":"","title":"Running the Capacity Calculator"},{"location":"toolbox/","text":"Toolbox The Culvert Analysis Toolkit is currently implemented as ArcToolbox for use in ArcGIS Pro Each tool in the toolbox contains built-in help text to explain tool functionality, inputs, and outputs. Summaries of tool usage follow. NOAA Rainfall Raster Data Downloader The NOAA Rainfall Raster Data Downloader does just that: it downloads rainfall rasters for your study area from NOAA's National Weather Service - Hydrometeorological Design Studies Center - Precipitation Frequency Data Server (PFDS) . By default, this tool acquires rainfall data for 24hr events for frequencies from 1 to 1000 years. All rasters are saved to a user-specified folder. This tool creates a precipitation source configuration JSON file in the output folder. The JSON file is used as a required input to other tools\u2014specifically those that calculate runoff/peak-flow. Note that NOAA Atlas 14 precip values are in millimeters; the capacity calculator an other tools convert the values to cm on-the-fly. NOAA rainfall rasters cover a large geographic area, so you may only need to use this tool occassionally. NAACC Table Ingest The NAACC Table Ingest tool will read in, validate, and extend a NAACC-compliant source table, saving the output as geodata (e.g., a file geodatabase feature class) for use in other culvert analysis tools, like the NAACC Culvert Capacity Calculator NAACC Culvert Capacity The NAACC Culvert Capacity tool measure the capacity of culverts to handle storm events using the TR-55 model. It does this by: calculating the capacity of the culvert(s) at a crossing calculating peak flow at the culvert over a hydrologically corrected digital elevation model for 24 hour storm events with frequencies of 1 to 1000 years comparing capacity of individual culverts and all culverts at a crossing to each peak-flow, and flagging the event at which the culverts and crossings exceed capacity. Culvert location data must be NAACC schema-compliant. Peak-Flow Calculator (planned; currently implemented with the NAACC Culvert Capacity tool) Calculate peak-flow for one or more points over a hydrologically corrected DEM. Points do not need comply with any predefined data model (such as NAACC).","title":"Toolbox"},{"location":"toolbox/#toolbox","text":"The Culvert Analysis Toolkit is currently implemented as ArcToolbox for use in ArcGIS Pro Each tool in the toolbox contains built-in help text to explain tool functionality, inputs, and outputs. Summaries of tool usage follow.","title":"Toolbox"},{"location":"toolbox/#noaa-rainfall-raster-data-downloader","text":"The NOAA Rainfall Raster Data Downloader does just that: it downloads rainfall rasters for your study area from NOAA's National Weather Service - Hydrometeorological Design Studies Center - Precipitation Frequency Data Server (PFDS) . By default, this tool acquires rainfall data for 24hr events for frequencies from 1 to 1000 years. All rasters are saved to a user-specified folder. This tool creates a precipitation source configuration JSON file in the output folder. The JSON file is used as a required input to other tools\u2014specifically those that calculate runoff/peak-flow. Note that NOAA Atlas 14 precip values are in millimeters; the capacity calculator an other tools convert the values to cm on-the-fly. NOAA rainfall rasters cover a large geographic area, so you may only need to use this tool occassionally.","title":"NOAA Rainfall Raster Data Downloader"},{"location":"toolbox/#naacc-table-ingest","text":"The NAACC Table Ingest tool will read in, validate, and extend a NAACC-compliant source table, saving the output as geodata (e.g., a file geodatabase feature class) for use in other culvert analysis tools, like the NAACC Culvert Capacity Calculator","title":"NAACC Table Ingest"},{"location":"toolbox/#naacc-culvert-capacity","text":"The NAACC Culvert Capacity tool measure the capacity of culverts to handle storm events using the TR-55 model. It does this by: calculating the capacity of the culvert(s) at a crossing calculating peak flow at the culvert over a hydrologically corrected digital elevation model for 24 hour storm events with frequencies of 1 to 1000 years comparing capacity of individual culverts and all culverts at a crossing to each peak-flow, and flagging the event at which the culverts and crossings exceed capacity. Culvert location data must be NAACC schema-compliant.","title":"NAACC Culvert Capacity"},{"location":"toolbox/#peak-flow-calculator","text":"(planned; currently implemented with the NAACC Culvert Capacity tool) Calculate peak-flow for one or more points over a hydrologically corrected DEM. Points do not need comply with any predefined data model (such as NAACC).","title":"Peak-Flow Calculator"}]}