{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Culvert Analysis Toolkit This documentation is a work-in-progress The Culvert Analysis Toolkit is a collection of GIS tools designed to support analysis of culvert performance within their watershed. It uses a TR-55 Model and parameters derived from geospatial data to calculate peak-flow and culvert capacity. This software has been developed by CivicMapper in collaboration with GroundPoint Engineering , and encompasses work from a collaboration with the Cornell Soil & Water Lab (on GitHub @ github.com/SoilWaterLab ). See Credits/Contributors for more information. Getting Started Installation : get the Culvert Analysis Toolkit set up in ArcGIS Pro Data Guides : walk-throughs of the types inputs the tool requires and how to prepare them Analysis Guide : an overview of the tools and what they do. using the tool and working with the results Calculators: an explanation of the peak-flow and capacity calculators, with links to the underlying calculation code on GitHub Who is this toolkit for? The toolkit is designed to support understanding the efficacy of stormwater culvert infrastructure at a broad scale for planning purposes. To that end, the tool has two audiences: Planners, who can use the outputs to support decision-making Analysts, who are able to run the tool in GIS software and are comforttable wrangling the spatial datasets that are required inputs of the tools What this toolkit is not This toolkit is not: a replacement for engineering tools like HEC-RAS or SWMM appropriate for supporting the design and engineering of indivdual culverts Credits/Contributors This software encompasses work originally developed by the Cornell Soil & Water Lab (on GitHub @ github.com/SoilWaterLab ) This repository represents an evolution of a previous effort, the Peak-Flow Calculator , which was a hard fork of the Water Lab's CulvertEvalution repository. Made in collaboration with the Cornell S&W lab, this repository includes additional updates to the science of the from CulvertModel_2.1 . Original peak flow analytics are based on the culvert evaluation model developed by Rebecca Marjerison at the Cornell Soil and Water Lab in 2013, as CulvertEvalution David Gold, python script development, August 4, 2015 Object-oriented structure and resiliency updates built by Noah Warnke, August 31 2016 (no formulas changed). Updated by Zoya Kaufmann June 2016 - August 2017 Merged with older versions by Tanvi Naidu June 19 2017 Fork, refactor, and creation of CLI and ArcMap interfaces by Christian Gass @ CivicMapper, Fall 2017, as peak-flow-calculator Updates for use within ArcGIS Pro by Christian Gass @ CivicMapper, Spring/Summer 2019, in peak-flow-calculator CulvertModel_2.1 by Jo Archibald in 2019 Drain-It repository by CivicMapper, 2021-2022","title":"Culvert Analysis Toolkit"},{"location":"#culvert-analysis-toolkit","text":"This documentation is a work-in-progress The Culvert Analysis Toolkit is a collection of GIS tools designed to support analysis of culvert performance within their watershed. It uses a TR-55 Model and parameters derived from geospatial data to calculate peak-flow and culvert capacity. This software has been developed by CivicMapper in collaboration with GroundPoint Engineering , and encompasses work from a collaboration with the Cornell Soil & Water Lab (on GitHub @ github.com/SoilWaterLab ). See Credits/Contributors for more information.","title":"Culvert Analysis Toolkit"},{"location":"#getting-started","text":"Installation : get the Culvert Analysis Toolkit set up in ArcGIS Pro Data Guides : walk-throughs of the types inputs the tool requires and how to prepare them Analysis Guide : an overview of the tools and what they do. using the tool and working with the results Calculators: an explanation of the peak-flow and capacity calculators, with links to the underlying calculation code on GitHub","title":"Getting Started"},{"location":"#who-is-this-toolkit-for","text":"The toolkit is designed to support understanding the efficacy of stormwater culvert infrastructure at a broad scale for planning purposes. To that end, the tool has two audiences: Planners, who can use the outputs to support decision-making Analysts, who are able to run the tool in GIS software and are comforttable wrangling the spatial datasets that are required inputs of the tools","title":"Who is this toolkit for?"},{"location":"#what-this-toolkit-is-not","text":"This toolkit is not: a replacement for engineering tools like HEC-RAS or SWMM appropriate for supporting the design and engineering of indivdual culverts","title":"What this toolkit is not"},{"location":"#creditscontributors","text":"This software encompasses work originally developed by the Cornell Soil & Water Lab (on GitHub @ github.com/SoilWaterLab ) This repository represents an evolution of a previous effort, the Peak-Flow Calculator , which was a hard fork of the Water Lab's CulvertEvalution repository. Made in collaboration with the Cornell S&W lab, this repository includes additional updates to the science of the from CulvertModel_2.1 . Original peak flow analytics are based on the culvert evaluation model developed by Rebecca Marjerison at the Cornell Soil and Water Lab in 2013, as CulvertEvalution David Gold, python script development, August 4, 2015 Object-oriented structure and resiliency updates built by Noah Warnke, August 31 2016 (no formulas changed). Updated by Zoya Kaufmann June 2016 - August 2017 Merged with older versions by Tanvi Naidu June 19 2017 Fork, refactor, and creation of CLI and ArcMap interfaces by Christian Gass @ CivicMapper, Fall 2017, as peak-flow-calculator Updates for use within ArcGIS Pro by Christian Gass @ CivicMapper, Spring/Summer 2019, in peak-flow-calculator CulvertModel_2.1 by Jo Archibald in 2019 Drain-It repository by CivicMapper, 2021-2022","title":"Credits/Contributors"},{"location":"analysis-bp/","text":"Analysis Best Practices Using the tools; best practices for working with large datasets and basins Model Input Consideration Balancing DEM hydrologic and NAACC location-correctedness Full hydrologic correction of the DEM and re-locating of culverts with LIDAR and imagery snap culverts to available hydro steam lines, burn the lines into the DEMs Depends on the use case!","title":"Analysis Best Practices"},{"location":"analysis-bp/#analysis-best-practices","text":"Using the tools; best practices for working with large datasets and basins","title":"Analysis Best Practices"},{"location":"analysis-bp/#model-input-consideration","text":"Balancing DEM hydrologic and NAACC location-correctedness Full hydrologic correction of the DEM and re-locating of culverts with LIDAR and imagery snap culverts to available hydro steam lines, burn the lines into the DEMs Depends on the use case!","title":"Model Input Consideration"},{"location":"analysis-overview/","text":"Toolbox Overview The Culvert Analysis Toolkit is currently implemented as ArcToolbox for use in ArcGIS Pro Each tool in the toolbox contains built-in help text to explain tool functionality, inputs, and outputs. Summaries of tool usage follow. NOAA Rainfall Raster Data Downloader The NOAA Rainfall Raster Data Downloader does just that: it downloads rainfall rasters for your study area from NOAA's National Weather Service - Hydrometeorological Design Studies Center - Precipitation Frequency Data Server (PFDS) . By default, this tool acquires rainfall data for 24hr events for frequencies from 1 to 1000 years. All rasters are saved to a user-specified folder. This tool creates a precipitation source configuration JSON file in the output folder. The JSON file is used as a required input to other tools\u2014specifically those that calculate runoff/peak-flow. Note that NOAA Atlas 14 precip values are in 1000ths of an inch ; the capacity calculator an other tools convert the values to centimeters on-the-fly. NOAA rainfall rasters cover a large geographic area, so you may only need to use this tool occassionally. NAACC Table Ingest The NAACC Table Ingest tool will read in, validate, and extend a NAACC-compliant source table, saving the output as geodata (e.g., a file geodatabase feature class) for use in other culvert analysis tools, like the NAACC Culvert Capacity Calculator NAACC Data Snapping The NAACC Data Snapping tool can be used to reposition features in a NAACC-compliant feature class to locations in another feature class; e.g., move the NAACC culvert records to point features that have been snapped to streams on a hydrologically corrected DEM. Curve Number Generator (planned; previously implemented in the stand-alone Peak Flow Calculator toolbox ) NAACC Culvert Capacity The NAACC Culvert Capacity tool measure the capacity of culverts to handle storm events using the TR-55 model. It does this by: calculating the capacity of the culvert(s) at a crossing calculating peak flow at the culvert over a hydrologically corrected digital elevation model for 24 hour storm events with frequencies of 1 to 1000 years comparing capacity of individual culverts and all culverts at a crossing to each peak-flow, and flagging the event at which the culverts and crossings exceed capacity. Culvert location data must be NAACC schema-compliant. Peak-Flow Calculator (planned; currently implemented with the NAACC Culvert Capacity tool) Calculate peak-flow for one or more points over a hydrologically corrected DEM. Points do not need comply with any predefined data model (such as NAACC).","title":"Toolbox Overview"},{"location":"analysis-overview/#toolbox-overview","text":"The Culvert Analysis Toolkit is currently implemented as ArcToolbox for use in ArcGIS Pro Each tool in the toolbox contains built-in help text to explain tool functionality, inputs, and outputs. Summaries of tool usage follow.","title":"Toolbox Overview"},{"location":"analysis-overview/#noaa-rainfall-raster-data-downloader","text":"The NOAA Rainfall Raster Data Downloader does just that: it downloads rainfall rasters for your study area from NOAA's National Weather Service - Hydrometeorological Design Studies Center - Precipitation Frequency Data Server (PFDS) . By default, this tool acquires rainfall data for 24hr events for frequencies from 1 to 1000 years. All rasters are saved to a user-specified folder. This tool creates a precipitation source configuration JSON file in the output folder. The JSON file is used as a required input to other tools\u2014specifically those that calculate runoff/peak-flow. Note that NOAA Atlas 14 precip values are in 1000ths of an inch ; the capacity calculator an other tools convert the values to centimeters on-the-fly. NOAA rainfall rasters cover a large geographic area, so you may only need to use this tool occassionally.","title":"NOAA Rainfall Raster Data Downloader"},{"location":"analysis-overview/#naacc-table-ingest","text":"The NAACC Table Ingest tool will read in, validate, and extend a NAACC-compliant source table, saving the output as geodata (e.g., a file geodatabase feature class) for use in other culvert analysis tools, like the NAACC Culvert Capacity Calculator","title":"NAACC Table Ingest"},{"location":"analysis-overview/#naacc-data-snapping","text":"The NAACC Data Snapping tool can be used to reposition features in a NAACC-compliant feature class to locations in another feature class; e.g., move the NAACC culvert records to point features that have been snapped to streams on a hydrologically corrected DEM.","title":"NAACC Data Snapping"},{"location":"analysis-overview/#curve-number-generator","text":"(planned; previously implemented in the stand-alone Peak Flow Calculator toolbox )","title":"Curve Number Generator"},{"location":"analysis-overview/#naacc-culvert-capacity","text":"The NAACC Culvert Capacity tool measure the capacity of culverts to handle storm events using the TR-55 model. It does this by: calculating the capacity of the culvert(s) at a crossing calculating peak flow at the culvert over a hydrologically corrected digital elevation model for 24 hour storm events with frequencies of 1 to 1000 years comparing capacity of individual culverts and all culverts at a crossing to each peak-flow, and flagging the event at which the culverts and crossings exceed capacity. Culvert location data must be NAACC schema-compliant.","title":"NAACC Culvert Capacity"},{"location":"analysis-overview/#peak-flow-calculator","text":"(planned; currently implemented with the NAACC Culvert Capacity tool) Calculate peak-flow for one or more points over a hydrologically corrected DEM. Points do not need comply with any predefined data model (such as NAACC).","title":"Peak-Flow Calculator"},{"location":"calcs-culvert-capacity/","text":"Culvert Capacity Culvert Capacity is calculated using an equation from FHWA Eqn A.3, pg 191. The equation, expressed in Python , is as follows: capacity = ( culvert_area_sqm * math.sqrt( culvert_depth_m * ( ( head_over_invert / culvert_depth_m ) - coefficient_y - coefficient_slope * slope_rr ) / coefficient_c ) ) / si_conv_factor Variables shown above are as follows: culvert_area_sqm : internal surface area of the culvert head_over_invert : Hydraulic head above the culvert invert, meters culvert_depth_m : Culvert depth. Diameter or dimension b, (height of culvert) meters slope_rr : slope rise/run (meters) coefficient_slope : slope coefficient from FHWA engineering pub HIF12026, appendix A. -0.5, except where inlet is mitered in which case +0.7 coefficient_y : coefficient based on shape and material from FHWA engineering pub HIF12026 coefficient_c : coefficient based on shape and material from FHWA engineering pub HIF12026 si_conv_factor : adjustment factor for units (SI=1.811), defaults to 1.811 The equation returns capacity : capacity in cubic meters / second (m^3/s) Constants coefficient_c , coefficient_y , coefficient_slope are set based on the culvert entrance shape and material, from FHWA engineering pub HIF12026, appendix A. In the code The capacity calculator module in this tool is located in src/drainit/calculators/capacity.py","title":"Culvert Capacity"},{"location":"calcs-culvert-capacity/#culvert-capacity","text":"Culvert Capacity is calculated using an equation from FHWA Eqn A.3, pg 191. The equation, expressed in Python , is as follows: capacity = ( culvert_area_sqm * math.sqrt( culvert_depth_m * ( ( head_over_invert / culvert_depth_m ) - coefficient_y - coefficient_slope * slope_rr ) / coefficient_c ) ) / si_conv_factor Variables shown above are as follows: culvert_area_sqm : internal surface area of the culvert head_over_invert : Hydraulic head above the culvert invert, meters culvert_depth_m : Culvert depth. Diameter or dimension b, (height of culvert) meters slope_rr : slope rise/run (meters) coefficient_slope : slope coefficient from FHWA engineering pub HIF12026, appendix A. -0.5, except where inlet is mitered in which case +0.7 coefficient_y : coefficient based on shape and material from FHWA engineering pub HIF12026 coefficient_c : coefficient based on shape and material from FHWA engineering pub HIF12026 si_conv_factor : adjustment factor for units (SI=1.811), defaults to 1.811 The equation returns capacity : capacity in cubic meters / second (m^3/s) Constants coefficient_c , coefficient_y , coefficient_slope are set based on the culvert entrance shape and material, from FHWA engineering pub HIF12026, appendix A.","title":"Culvert Capacity"},{"location":"calcs-culvert-capacity/#in-the-code","text":"The capacity calculator module in this tool is located in src/drainit/calculators/capacity.py","title":"In the code"},{"location":"calcs-peak-flow/","text":"Peak Flow Runoff peak discharge of given point's watershed is determined using the SCS graphical curve number method. For more information on this method, see Technical Release 55 . In the code The time of concentration equation used in this tool is located in src/drainit/calculators/runoff.py , in the time_of_concentration_calculator function The peak flow calculator function in this tool is located in src/drainit/calculators/runoff.py , in the peak_flow_calculator function .","title":"Peak Flow"},{"location":"calcs-peak-flow/#peak-flow","text":"Runoff peak discharge of given point's watershed is determined using the SCS graphical curve number method. For more information on this method, see Technical Release 55 .","title":"Peak Flow"},{"location":"calcs-peak-flow/#in-the-code","text":"The time of concentration equation used in this tool is located in src/drainit/calculators/runoff.py , in the time_of_concentration_calculator function The peak flow calculator function in this tool is located in src/drainit/calculators/runoff.py , in the peak_flow_calculator function .","title":"In the code"},{"location":"capacitycalc-results/","text":"Working with Capacity Calculator Results Esri Arcade: var fs = FeatureSetByName($datastore, \"<name of output layer here>\") var max_return_period_normalized = ($feature.max_return_period - MIN(fs, \"max_return_period\")) / (MAX(fs, \"max_return_period\") - MIN(fs, \"max_return_period\")); var shed_area_sqkm_normalized = ($feature.shed_area_sqkm - MIN(fs, \"shed_area_sqkm\")) / (MAX(fs, \"shed_area_sqkm\") - MIN(fs, \"shed_area_sqkm\")); return max_return_period_normalized / shed_area_sqkm_normalized;","title":"Working with Capacity Calculator Results"},{"location":"capacitycalc-results/#working-with-capacity-calculator-results","text":"Esri Arcade: var fs = FeatureSetByName($datastore, \"<name of output layer here>\") var max_return_period_normalized = ($feature.max_return_period - MIN(fs, \"max_return_period\")) / (MAX(fs, \"max_return_period\") - MIN(fs, \"max_return_period\")); var shed_area_sqkm_normalized = ($feature.shed_area_sqkm - MIN(fs, \"shed_area_sqkm\")) / (MAX(fs, \"shed_area_sqkm\") - MIN(fs, \"shed_area_sqkm\")); return max_return_period_normalized / shed_area_sqkm_normalized;","title":"Working with Capacity Calculator Results"},{"location":"capacitycalc-run-batch/","text":"Batch Running the Capacity Calculator approaches for batching analysis for large areas","title":"Batch Running the Capacity Calculator"},{"location":"capacitycalc-run-batch/#batch-running-the-capacity-calculator","text":"approaches for batching analysis for large areas","title":"Batch Running the Capacity Calculator"},{"location":"capacitycalc-run-one/","text":"Running the Capacity Calculator","title":"Running the Capacity Calculator"},{"location":"capacitycalc-run-one/#running-the-capacity-calculator","text":"","title":"Running the Capacity Calculator"},{"location":"data-curve-number-raster/","text":"Generating a Curve Number Raster","title":"Generating a Curve Number Raster"},{"location":"data-curve-number-raster/#generating-a-curve-number-raster","text":"","title":"Generating a Curve Number Raster"},{"location":"data-dem/","text":"Digital Elevation Model-derived Data (Notes on Hydrologically-corrected Digital Elevation Models (DEMs))","title":"Digital Elevation Model-derived Data"},{"location":"data-dem/#digital-elevation-model-derived-data","text":"(Notes on Hydrologically-corrected Digital Elevation Models (DEMs))","title":"Digital Elevation Model-derived Data"},{"location":"data-naacc-table/","text":"Working with NAACC Culvert Data (Notes NAACC culvert data accuracy (spatial and temporal)) Initial Download and Clean-Up Download the XLSX file from NAACC Delete headers (first eight rows) Save as CSV Optionally: Pre-Process the NAACC table While the NAACC Table Ingest (described below) will flag records that aren't valid for capacity calculations, you may want to pair back to download to records of interest. You may want to: remove certain types of culvert, e.g., bridges, fords, or ones that don't have any capacity measurements. import this table into GIS, and move features to streams or flow lines on a digital elevation model Regardless, as long as the NAACC schema is preserved, subsequent tools will be able to use it. Run the NAACC Table Ingest tool The NAACC Table Ingest tool will read in, validate, and extend a NAACC-compliant source table, saving the output as geodata (e.g., an Esri file geodatabase feature class). Use the prepared CSV above as an input. If you've imported that CSV to a file geodatabase feature class already, that feature class will also work. What is changed in the data by this tool: new fields related to data validation: include validation_errors new fields for storing transformed copies of capacity model-specific attributes (e.g. values with unit conversion applied). NAACC field: new field Material : culv_mat Inlet_Type : in_type Inlet_Structure_Type : in_shape Inlet_Width : in_a Inlet_Height : in_b Road_Fill_Height : hw Slope_Percent : slope Crossing_Structure_Length : length Outlet_Structure_Type : out_shape Outlet_Width : out_a Outlet_Height : out_b Crossing_Type : crossing_type Crossing_Comment : comments new fields for storing calculator results: Optionally: Run the NAACC Data Snapping tool Depending on your needs, you may find that the location precision of the supplied NAACC data was not adequate compared to the accuracy of your hydrologically corrected DEM . In that case, you may have moved culverts manually or snapped points to streams. If you need to update your NAACC table with better location data from an external table, use the NAACC Data Snapping tool to update the input NAACC-compliant source table with locations from another table. (This tool basically runs a reverse 1-to-many join, replacing geometry in one or more feature class records with a single geometry from feature in a reference table using a column-based match). What is changed in the data by this tool: updated geometry new field: resnapped : boolean field indicating if the record has been re-snapped based on the supplied reference geometry.","title":"Working with NAACC Culvert Data"},{"location":"data-naacc-table/#working-with-naacc-culvert-data","text":"(Notes NAACC culvert data accuracy (spatial and temporal))","title":"Working with NAACC Culvert Data"},{"location":"data-naacc-table/#initial-download-and-clean-up","text":"Download the XLSX file from NAACC Delete headers (first eight rows) Save as CSV","title":"Initial Download and Clean-Up"},{"location":"data-naacc-table/#optionally-pre-process-the-naacc-table","text":"While the NAACC Table Ingest (described below) will flag records that aren't valid for capacity calculations, you may want to pair back to download to records of interest. You may want to: remove certain types of culvert, e.g., bridges, fords, or ones that don't have any capacity measurements. import this table into GIS, and move features to streams or flow lines on a digital elevation model Regardless, as long as the NAACC schema is preserved, subsequent tools will be able to use it.","title":"Optionally: Pre-Process the NAACC table"},{"location":"data-naacc-table/#run-the-naacc-table-ingest-tool","text":"The NAACC Table Ingest tool will read in, validate, and extend a NAACC-compliant source table, saving the output as geodata (e.g., an Esri file geodatabase feature class). Use the prepared CSV above as an input. If you've imported that CSV to a file geodatabase feature class already, that feature class will also work.","title":"Run the NAACC Table Ingest tool"},{"location":"data-naacc-table/#what-is-changed-in-the-data-by-this-tool","text":"new fields related to data validation: include validation_errors new fields for storing transformed copies of capacity model-specific attributes (e.g. values with unit conversion applied). NAACC field: new field Material : culv_mat Inlet_Type : in_type Inlet_Structure_Type : in_shape Inlet_Width : in_a Inlet_Height : in_b Road_Fill_Height : hw Slope_Percent : slope Crossing_Structure_Length : length Outlet_Structure_Type : out_shape Outlet_Width : out_a Outlet_Height : out_b Crossing_Type : crossing_type Crossing_Comment : comments new fields for storing calculator results:","title":"What is changed in the data by this tool:"},{"location":"data-naacc-table/#optionally-run-the-naacc-data-snapping-tool","text":"Depending on your needs, you may find that the location precision of the supplied NAACC data was not adequate compared to the accuracy of your hydrologically corrected DEM . In that case, you may have moved culverts manually or snapped points to streams. If you need to update your NAACC table with better location data from an external table, use the NAACC Data Snapping tool to update the input NAACC-compliant source table with locations from another table. (This tool basically runs a reverse 1-to-many join, replacing geometry in one or more feature class records with a single geometry from feature in a reference table using a column-based match).","title":"Optionally: Run the NAACC Data Snapping tool"},{"location":"data-naacc-table/#what-is-changed-in-the-data-by-this-tool_1","text":"updated geometry new field: resnapped : boolean field indicating if the record has been re-snapped based on the supplied reference geometry.","title":"What is changed in the data by this tool:"},{"location":"data-noaa-rainfall/","text":"Getting NOAA Rainfall Data Location-specific rainfall measurements from NOAA are required inputs for the tool. Specifically: rainfall rasters from NOAA's National Weather Service - Hydrometeorological Design Studies Center - Precipitation Frequency Data Server (PFDS) are used to calculate average rainfall over the upstream contributing area to a culvert, which is used to calculate peak-flow at the culvert. NOAA Rainfall Raster Downloader The Culvert Analysis Toolkit includes a tool that automatically downloads the correct rasters for your area of interest: NOAA Rainfall Raster Downloader . The NOAA Rainfall Raster Data Downloader does just that: it downloads rainfall rasters for your study area from NOAA's National Weather Service - Hydrometeorological Design Studies Center - Precipitation Frequency Data Server (PFDS). By default, this tool acquires rainfall data for 24hr events for frequencies from 1 to 1000 years. All rasters are saved to a user-specified folder. This tool creates a precipitation source configuration JSON file in the output folder. The JSON file is used as a required input to other tools\u2014specifically those that calculate runoff/peak-flow. Note that NOAA Atlas 14 precip values are in 1000ths of an inch; the capacity calculator an other tools convert the values to centimeters on-the-fly. NOAA rainfall rasters cover a large geographic area, so you may only need to use this tool occassionally.","title":"Getting NOAA Rainfall Data"},{"location":"data-noaa-rainfall/#getting-noaa-rainfall-data","text":"Location-specific rainfall measurements from NOAA are required inputs for the tool. Specifically: rainfall rasters from NOAA's National Weather Service - Hydrometeorological Design Studies Center - Precipitation Frequency Data Server (PFDS) are used to calculate average rainfall over the upstream contributing area to a culvert, which is used to calculate peak-flow at the culvert.","title":"Getting NOAA Rainfall Data"},{"location":"data-noaa-rainfall/#noaa-rainfall-raster-downloader","text":"The Culvert Analysis Toolkit includes a tool that automatically downloads the correct rasters for your area of interest: NOAA Rainfall Raster Downloader . The NOAA Rainfall Raster Data Downloader does just that: it downloads rainfall rasters for your study area from NOAA's National Weather Service - Hydrometeorological Design Studies Center - Precipitation Frequency Data Server (PFDS). By default, this tool acquires rainfall data for 24hr events for frequencies from 1 to 1000 years. All rasters are saved to a user-specified folder. This tool creates a precipitation source configuration JSON file in the output folder. The JSON file is used as a required input to other tools\u2014specifically those that calculate runoff/peak-flow. Note that NOAA Atlas 14 precip values are in 1000ths of an inch; the capacity calculator an other tools convert the values to centimeters on-the-fly. NOAA rainfall rasters cover a large geographic area, so you may only need to use this tool occassionally.","title":"NOAA Rainfall Raster Downloader"},{"location":"data-overview/","text":"Overview The calculators provided by the Culvert Toolkit rely on specific spatial datasets to derive location-specific parameters that are then used as inputs to stormwater runoff and culvert capacity models. Types of Input Datasets The section describes what, where, and how to acquire the various inputs required to run the tool. Note that a number of these inputs require some basic competency in GIS to create, as they are not necessarily available off-the-shelf (depending on your area of interest). NAACC culvert/crossing records The culvert/crossing records available from NAACC provide the starting point for the analysis. See Working with NAACC Culvert Data for more information. Digital Elevation Model (DEM) The DEM provides the data for determining what is upstream of a culvert/crossing, as well as some characteristics of that area that are important to calculating peak flow. Sources for a DEM could be: Elevation raster Elevation TIN Elevation point clouds (i.e., from LiDAR) From any of those sources, the analytical tools require one or more of the following rasters for your area of interest. slope flow direction flow length (optional) See Digital Elevation Model-derived Data for more information. Curve Number The curve number represents the runoff potential of the contributing watershed above a culvert. It is derived from a combination of landcover and soil condition data. Sources: Soils Landcover TR-55 Manual Table 2.1 Derive a single curve number raster for your area of interest Rainfall See Getting NOAA Rainfall Data for more information. Sources: NOAA rainfall rasters for your area of interest Note: (Re)Enable support NOAA precipation table in the future. Preparing Data Considerations for Preparing Data You'll need to determine the the trade-off between speed and accuracy based on your use case: Ideal: full hydrologic correction of the DEM and re-locating of culverts with LIDAR and imagery Workable: fill sinks in DEM; burn hydro lines into the DEMs; snap culverts to available hydro steam lines; The best approach for determining DEM hydrologic-accuracy and NAACC location-correctedness depends on your use case.","title":"Overview"},{"location":"data-overview/#overview","text":"The calculators provided by the Culvert Toolkit rely on specific spatial datasets to derive location-specific parameters that are then used as inputs to stormwater runoff and culvert capacity models.","title":"Overview"},{"location":"data-overview/#types-of-input-datasets","text":"The section describes what, where, and how to acquire the various inputs required to run the tool. Note that a number of these inputs require some basic competency in GIS to create, as they are not necessarily available off-the-shelf (depending on your area of interest).","title":"Types of Input Datasets"},{"location":"data-overview/#naacc-culvertcrossing-records","text":"The culvert/crossing records available from NAACC provide the starting point for the analysis. See Working with NAACC Culvert Data for more information.","title":"NAACC culvert/crossing records"},{"location":"data-overview/#digital-elevation-model-dem","text":"The DEM provides the data for determining what is upstream of a culvert/crossing, as well as some characteristics of that area that are important to calculating peak flow. Sources for a DEM could be: Elevation raster Elevation TIN Elevation point clouds (i.e., from LiDAR) From any of those sources, the analytical tools require one or more of the following rasters for your area of interest. slope flow direction flow length (optional) See Digital Elevation Model-derived Data for more information.","title":"Digital Elevation Model (DEM)"},{"location":"data-overview/#curve-number","text":"The curve number represents the runoff potential of the contributing watershed above a culvert. It is derived from a combination of landcover and soil condition data. Sources: Soils Landcover TR-55 Manual Table 2.1 Derive a single curve number raster for your area of interest","title":"Curve Number"},{"location":"data-overview/#rainfall","text":"See Getting NOAA Rainfall Data for more information. Sources: NOAA rainfall rasters for your area of interest","title":"Rainfall"},{"location":"data-overview/#note","text":"(Re)Enable support NOAA precipation table in the future.","title":"Note:"},{"location":"data-overview/#preparing-data","text":"","title":"Preparing Data"},{"location":"data-overview/#considerations-for-preparing-data","text":"You'll need to determine the the trade-off between speed and accuracy based on your use case: Ideal: full hydrologic correction of the DEM and re-locating of culverts with LIDAR and imagery Workable: fill sinks in DEM; burn hydro lines into the DEMs; snap culverts to available hydro steam lines; The best approach for determining DEM hydrologic-accuracy and NAACC location-correctedness depends on your use case.","title":"Considerations for Preparing Data"},{"location":"dev-setup/","text":"Setup Anaconda Python and dependencies Development requires access to the arcpy library include with ArcGIS Pro, and a ArcGIS Pro-dervied Conda environment that includes the dependenices listed in setup\\requirements.txt","title":"Setup Anaconda Python and dependencies"},{"location":"dev-setup/#setup-anaconda-python-and-dependencies","text":"Development requires access to the arcpy library include with ArcGIS Pro, and a ArcGIS Pro-dervied Conda environment that includes the dependenices listed in setup\\requirements.txt","title":"Setup Anaconda Python and dependencies"},{"location":"dev/","text":"Developing the Toolkit Setup Anaconda Python and dependencies Development requires access to the arcpy library include with ArcGIS Pro, and a ArcGIS Pro-dervied Conda environment that includes the dependenices listed in setup\\requirements.txt Project Structure The project is structure so there is a fairly clear separation of concerns between the code that handles the science behind the calculators the geoprocessing tools used to derive spatial statistics from the various map layers the specific i/o requirements and interfaces expected in end-user workflows src/ The folder contains external-facing interfaces that use the drainit package. It includes: CulvertToolbox.pyt and associated xml metadata. legacy drainit.tbx file (replaced by CulvertToolbox.pyt ) tbx_*.py scripts, which are workflow-specific and map 1:1 with tools in the ArcGIS Pro toolbox drainit.tbx . src/drainit/ This is the top-level package. It contains a few scripts: workflows.py Contains the code for executing analytical workflows at the highest level of abstraction. A single workflow is represented by a single python class. All workflow classes inherit from a base class that contains properties and methods for reading/writing workflow state to a JSON configuration file. cli.py Command line interface to the scripting tools (WIP). config.py and settings.py Constants used for script execution. models.py Internal data models used throughout the package. calculators/ Module containing the science and business logic of the various calculators available in the package: runoff/peak flow culvert capacity services/ Scripts for interacting with third-party domain-specific data sources (e.g., NOAA rainfall data, NAACC culvert data) and geoprocessing tools (e.g., Esri ArcPy, Whitebox tools). gp/ Geoprocessing services designed on specific provider tools (e.g., ESRI, Whitebox) and exposed through a generic class that is called by the workflow tools. This ensures workflow.py can run GP tools without needing to know exactly what underlying geoprocessing library is being used. esri/ This folder contains the built ArcGIS Pro Python toolbox, its metadata, and an arcpy interface script. These are automatically created during the build process and do not need to be manually edited under normal circumstances. Scripts: noaa and naaccc These are data provider-specific scripts that do domain-specific work with specific data types. tests/ Integration tests for workflows and tasks within workflows.","title":"Develop"},{"location":"dev/#developing-the-toolkit","text":"","title":"Developing the Toolkit"},{"location":"dev/#setup-anaconda-python-and-dependencies","text":"Development requires access to the arcpy library include with ArcGIS Pro, and a ArcGIS Pro-dervied Conda environment that includes the dependenices listed in setup\\requirements.txt","title":"Setup Anaconda Python and dependencies"},{"location":"dev/#project-structure","text":"The project is structure so there is a fairly clear separation of concerns between the code that handles the science behind the calculators the geoprocessing tools used to derive spatial statistics from the various map layers the specific i/o requirements and interfaces expected in end-user workflows","title":"Project Structure"},{"location":"dev/#src","text":"The folder contains external-facing interfaces that use the drainit package. It includes: CulvertToolbox.pyt and associated xml metadata. legacy drainit.tbx file (replaced by CulvertToolbox.pyt ) tbx_*.py scripts, which are workflow-specific and map 1:1 with tools in the ArcGIS Pro toolbox drainit.tbx .","title":"src/"},{"location":"dev/#srcdrainit","text":"This is the top-level package. It contains a few scripts:","title":"src/drainit/"},{"location":"dev/#workflowspy","text":"Contains the code for executing analytical workflows at the highest level of abstraction. A single workflow is represented by a single python class. All workflow classes inherit from a base class that contains properties and methods for reading/writing workflow state to a JSON configuration file.","title":"workflows.py"},{"location":"dev/#clipy","text":"Command line interface to the scripting tools (WIP).","title":"cli.py"},{"location":"dev/#configpy-and-settingspy","text":"Constants used for script execution.","title":"config.py and settings.py"},{"location":"dev/#modelspy","text":"Internal data models used throughout the package.","title":"models.py"},{"location":"dev/#calculators","text":"Module containing the science and business logic of the various calculators available in the package: runoff/peak flow culvert capacity","title":"calculators/"},{"location":"dev/#services","text":"Scripts for interacting with third-party domain-specific data sources (e.g., NOAA rainfall data, NAACC culvert data) and geoprocessing tools (e.g., Esri ArcPy, Whitebox tools).","title":"services/"},{"location":"dev/#gp","text":"Geoprocessing services designed on specific provider tools (e.g., ESRI, Whitebox) and exposed through a generic class that is called by the workflow tools. This ensures workflow.py can run GP tools without needing to know exactly what underlying geoprocessing library is being used.","title":"gp/"},{"location":"dev/#esri","text":"This folder contains the built ArcGIS Pro Python toolbox, its metadata, and an arcpy interface script. These are automatically created during the build process and do not need to be manually edited under normal circumstances.","title":"esri/"},{"location":"dev/#scripts-noaa-and-naaccc","text":"These are data provider-specific scripts that do domain-specific work with specific data types.","title":"Scripts: noaa and naaccc"},{"location":"dev/#tests","text":"Integration tests for workflows and tasks within workflows.","title":"tests/"},{"location":"install/","text":"Installing the Toolkit in ArcGIS Pro The Culvert Analysis Toolkit currently requires ArcGIS Pro version 3. 1. Create a dedicated Python environment in ArcGIS Pro Note: If you already have a custom Python environment ready to go, you can skip this step and use that instead. To use the toolkit, you'll need to install it a custom Python environment for ArcGIS Pro. Clone the default ArcGIS Pro conda environment . Switch the current ArcGIS Pro conda environment to the cloned environment using the Python Package Manager . For more information on working with Python environments in ArcGIS Pro, see Esri's documentation . Once you've done this, close ArcGIS Pro. 2. Download the Culvert Analysis Toolkit installation file Download the latest install \"wheel\" here . 3. Install Now that you have the installation file and the custom Python environment, you can install the toolbox. ArcGIS Pro comes with a \"Python Command Prompt\" shortcut available, which runs a batch script that automatically starts a command prompt with ArcGIS Pro's active Conda environment available. Typically this gets added to your Windows Start Menu alongside the shortcut to ArcGIS Pro. Open the Python Command Prompt that came with your ArcGIS Pro installation. In the command prompt, run pip install \"<path-to-the-whl-file\\drainit.whl>\" . You'll replace \"<path-to-the-whl-file\\drainit.whl>\" with the full path to the wheel file you downloaded in the previous step. Include the quotes \" . Restart ArcGIS Pro. Open an existing or new project, and open the Geoprocessing you should see a Culvert Analysis Toolkit toolbox listed alongside other toolboxes in the ArcToolbox pane of ArcGIS Pro: Handling Upgrades Upgrading the toolkit When a new release of the toolkit is available, you won't need to create a new dedicated Python environment as described in step #1 above. Download the new release (#2) and install (#3) in your existing custom environment to replace the older version of the toolkit. Upgrades to ArcGIS Pro Since version 3.0, ArcGIS Pro provides a path for upgrading custom Python environments made with previous versions. Depending on the changes to the Python version, that upgrade may or may not affect the toolbox.","title":"Install"},{"location":"install/#installing-the-toolkit-in-arcgis-pro","text":"The Culvert Analysis Toolkit currently requires ArcGIS Pro version 3.","title":"Installing the Toolkit in ArcGIS Pro"},{"location":"install/#1-create-a-dedicated-python-environment-in-arcgis-pro","text":"Note: If you already have a custom Python environment ready to go, you can skip this step and use that instead. To use the toolkit, you'll need to install it a custom Python environment for ArcGIS Pro. Clone the default ArcGIS Pro conda environment . Switch the current ArcGIS Pro conda environment to the cloned environment using the Python Package Manager . For more information on working with Python environments in ArcGIS Pro, see Esri's documentation . Once you've done this, close ArcGIS Pro.","title":"1. Create a dedicated Python environment in ArcGIS Pro"},{"location":"install/#2-download-the-culvert-analysis-toolkit-installation-file","text":"Download the latest install \"wheel\" here .","title":"2. Download the Culvert Analysis Toolkit installation file"},{"location":"install/#3-install","text":"Now that you have the installation file and the custom Python environment, you can install the toolbox. ArcGIS Pro comes with a \"Python Command Prompt\" shortcut available, which runs a batch script that automatically starts a command prompt with ArcGIS Pro's active Conda environment available. Typically this gets added to your Windows Start Menu alongside the shortcut to ArcGIS Pro. Open the Python Command Prompt that came with your ArcGIS Pro installation. In the command prompt, run pip install \"<path-to-the-whl-file\\drainit.whl>\" . You'll replace \"<path-to-the-whl-file\\drainit.whl>\" with the full path to the wheel file you downloaded in the previous step. Include the quotes \" . Restart ArcGIS Pro. Open an existing or new project, and open the Geoprocessing you should see a Culvert Analysis Toolkit toolbox listed alongside other toolboxes in the ArcToolbox pane of ArcGIS Pro:","title":"3. Install"},{"location":"install/#handling-upgrades","text":"","title":"Handling Upgrades"},{"location":"install/#upgrading-the-toolkit","text":"When a new release of the toolkit is available, you won't need to create a new dedicated Python environment as described in step #1 above. Download the new release (#2) and install (#3) in your existing custom environment to replace the older version of the toolkit.","title":"Upgrading the toolkit"},{"location":"install/#upgrades-to-arcgis-pro","text":"Since version 3.0, ArcGIS Pro provides a path for upgrading custom Python environments made with previous versions. Depending on the changes to the Python version, that upgrade may or may not affect the toolbox.","title":"Upgrades to ArcGIS Pro"}]}